<!DOCTYPE html>
<html>
<head>
<style>
textarea {
}
</style>
</head>
<body>

<h1>Macro Expander</h1>

<p>source:</p>
<textarea id="src" rows="5" cols="90" placeholder="src" style="background-color:oldlace;">aaa</textarea>


<p>output:</p>
<textarea id="output" rows="7" cols="90" placeholder="transpiled"  readonly style="background-color:whitesmoke;">
</textarea>
<br>
<br>
<p id="status" > READY </p>

<!-- Ohm-JS -->
<script src="https://unpkg.com/ohm-js@16/dist/ohm.min.js"></script>


<!-- Macro preprocessor -->
<script src="mac.js"></script>


<br>
<button onclick="baseline ()">Test</button>
<script>

const grammars = String.raw`
Test {
rule = a+
a = "a"
}
`;

  const rewritefmt = String.raw`
rule [@cs] = [[~{cs}]]
a [c] = [[~{c}]]
`;
  
  function fixup (s) {
      return s
	  .replace (/~{/g, '${');
  }

  function baseline () {
      let src = document.getElementById('src').value;
      try {
          let [success, expanded] = expand1 (src, grammars, 'Test', rewritefmt, fixup);
          document.getElementById('output').value = expanded;
          if (success) {
              document.getElementById('status').innerHTML = "OK";
          } else {
              document.getElementById('status').innerHTML = "FAILED";
          }
      } catch (err) {
          document.getElementById('status').innerHTML = "parse FAILED";
      }
  }

  </script>
</body>
</html>


